<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Dashboard ‚Äî RMLCanteen</title>
  <link rel="stylesheet" href="style.css">
  <style>
    :root {
      --primary: #8B4513;
      --light: #fffdf9;
      --border: #d4c2a8;
      --text: #3e2f1c;
      --success: #4CAF50;
      --pending: #d7a24e;
      --preparing: #b87333;
      --delivery: #6b4f3a;
      --delivered: #3e8e41;
    }

    body {
      font-family: "Poppins", sans-serif;
      background: var(--light);
      margin: 0;
      padding: 0;
      color: var(--text);
    }

    .topbar {
      background: var(--primary);
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 25px;
    }
    .brand { font-weight: bold; font-size: 1.1rem; }
    .nav a { color: #fff; text-decoration: none; font-weight: 600; }

    main {
      max-width: 900px;
      margin: 40px auto;
      background: #fff;
      padding: 25px;
      border-radius: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    h2 {
      color: var(--primary);
      font-size: 1.4rem;
      margin-bottom: 20px;
    }

    /* Tabs */
    .tab-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
    }
    .tab-buttons button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 10px;
      background: #eee;
      cursor: pointer;
      font-weight: 600;
    }
    .tab-buttons button.active {
      background: var(--primary);
      color: #fff;
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Order Cards */
    .order-card {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      background: var(--light);
    }
    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      color: var(--primary);
    }
    .order-items {
      margin-top: 10px;
      font-size: 0.9rem;
      color: var(--text);
    }
    .status-badge {
      padding: 4px 10px;
      border-radius: 8px;
      color: #fff;
      font-size: 0.8rem;
      font-weight: bold;
    }
    .status-pending { background: var(--pending); }
    .status-preparing { background: var(--preparing); }
    .status-delivery { background: var(--delivery); }
    .status-delivered { background: var(--delivered); }

    .btn {
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      background: var(--primary);
      color: #fff;
      cursor: pointer;
      font-weight: 500;
      transition: 0.2s;
    }
    .btn:hover { opacity: 0.9; }
    .btn.small { font-size: 0.85rem; padding: 6px 10px; }
    .btn.ghost {
      background: #ddd;
      color: #333;
      cursor: not-allowed;
    }

    .status-buttons {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    select.status-select {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-weight: 500;
      background: #fff;
      cursor: pointer;
    }

    .btn.delete {
      background: crimson;
    }

    .buyer-info {
      margin-top: 10px;
      font-size: 0.9rem;
      background: #f9f5ef;
      padding: 10px;
      border-radius: 8px;
      border-left: 4px solid var(--primary);
    }
    .buyer-info strong {
      color: var(--primary);
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">RMLCanteen Admin</div>
    <nav class="nav">
      <a href="#" onclick="logoutUser()">Logout</a>
    </nav>
  </header>

  <main>
    <div class="tab-buttons">
      <button id="tabOrders" class="active" onclick="switchTab('orders')">üì¶ Update Order Status</button>
      <button id="tabMenu" onclick="switchTab('menu')">üçΩÔ∏è Menu (Sold Out / Available)</button>
    </div>

    <!-- ORDER STATUS UPDATE TAB -->
    <section id="ordersSection" class="tab-content active">
      <h2>Update Order Status</h2>
      <div id="ordersList"></div>
    </section>

    <!-- MENU TAB -->
    <section id="menuSection" class="tab-content">
      <h2>Menu Availability</h2>
      <div id="adminMenuList"></div>
      <button class="btn ghost" style="margin-top:20px;" onclick="resetAllSoldOut()">Restore All to Available</button>
    </section>
  </main>

  <script src="script.js"></script>
  <script>
    /* -------- Tab Switching -------- */
    function switchTab(tab) {
      document.getElementById('tabOrders').classList.remove('active');
      document.getElementById('tabMenu').classList.remove('active');
      document.getElementById('ordersSection').classList.remove('active');
      document.getElementById('menuSection').classList.remove('active');

      if (tab === 'orders') {
        document.getElementById('tabOrders').classList.add('active');
        document.getElementById('ordersSection').classList.add('active');
        renderAdminOrders();
      } else {
        document.getElementById('tabMenu').classList.add('active');
        document.getElementById('menuSection').classList.add('active');
        renderAdminMenuList();
      }
    }

    /* -------- Render Orders -------- */
    /* -------- Render Orders -------- */
function renderAdminOrders() {
  const orders = read(KEY_ORDERS, []);
  const container = document.getElementById('ordersList');
  if (orders.length === 0) {
    container.innerHTML = `<p class="muted">No orders yet.</p>`;
    return;
  }

  container.innerHTML = orders.map((o, idx) => {
    let badgeClass = "";
    switch (o.status) {
      case "Pending": badgeClass = "status-pending"; break;
      case "Preparing": badgeClass = "status-preparing"; break;
      case "Out for Delivery": badgeClass = "status-delivery"; break;
      case "Delivered": badgeClass = "status-delivered"; break;
      default: badgeClass = "status-pending";
    }

    // ‚úÖ Support both "fullname/contact/location" and fallback to "name/number/address"
    const buyerName = o.fullname || o.name || "N/A";
    const buyerContact = o.contact || o.number || "N/A";
    const buyerAddress = o.location || o.address || "N/A";

    return `
      <div class="order-card">
        <div class="order-header">
          <span>Order #${idx + 1}</span>
          <span class="status-badge ${badgeClass}">${o.status}</span>
        </div>

        <div class="buyer-info">
          <p><strong>Buyer:</strong> ${buyerName}</p>
          <p><strong>Contact:</strong> ${buyerContact}</p>
          <p><strong>Address:</strong> ${buyerAddress}</p>
        </div>

        <div class="order-items">
          ${o.items.map(it => `${it.name} √ó ${it.qty}`).join('<br>')}
        </div>

        <div style="margin-top:10px;"><strong>Total:</strong> ‚Ç±${Number(o.total).toFixed(2)}</div>

        <div class="status-buttons">
          <select class="status-select" onchange="updateOrderStatus(${idx}, this.value)">
            <option disabled selected>Change Status</option>
            <option value="Pending">Pending</option>
            <option value="Preparing">Preparing</option>
            <option value="Out for Delivery">Out for Delivery</option>
            <option value="Delivered">Delivered</option>
          </select>
          <button class="btn delete small" onclick="deleteOrder(${idx})">Delete</button>
        </div>
      </div>
    `;
  }).join('');
}


    /* -------- Update Status -------- */
    function updateOrderStatus(index, status) {
      const orders = read(KEY_ORDERS, []);
      if (!orders[index]) return;
      orders[index].status = status;
      write(KEY_ORDERS, orders);
      renderAdminOrders();
    }

    /* -------- Delete Order -------- */
    function deleteOrder(index) {
      const orders = read(KEY_ORDERS, []);
      if (!orders[index]) return;
      if (confirm(`Are you sure you want to delete Order #${index + 1}?`)) {
        orders.splice(index, 1);
        write(KEY_ORDERS, orders);
        renderAdminOrders();
      }
    }

    /* -------- Restore Menu -------- */
    function resetAllSoldOut() {
      if (confirm('Restore all menu items to available?')) {
        saveSoldOutItems([]);
        renderAdminMenuList();
        alert('‚úÖ All items are now available!');
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      ensureLoggedIn('admin');
      renderAdminOrders();
    });
  </script>
</body>
</html>
